<section class="login-page-container">
  <div class="animated-logo"></div>
  <div class="login-container">
    <header>
      <h1>{{ 'auth.login.title' | translate }}</h1>
      <p aria-live="polite">
        <app-typewriter></app-typewriter>
      </p>
    </header>

    <!-- Google OAuth Button -->
    <div class="oauth-section">
      <app-google-oauth-button
        (authStarted)="onOAuthStarted()"
        (authError)="onOAuthError($event)"
        [class.disabled]="isSubmitting || isOAuthInProgress">
      </app-google-oauth-button>

      <p class="oauth-hint">Callback local: http://localhost:4200/auth/oauth/google/callback</p>

      <div class="divider">
        <span>{{ 'auth.login.or_continue_with' | translate }}</span>
      </div>
    </div>

    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="auth-form">
      <!-- Mensagem de erro geral da API -->
      <div class="api-error" *ngIf="apiError">
        <span class="error-icon">⚠</span>
        <div>
          <strong>{{ apiError.summary | authError }}</strong>
          <p *ngIf="apiError.description">
            {{ apiError.description | authError }}
          </p>
        </div>
      </div>

      <!-- Campo Email -->
      <div class="form-field">
        <label for="email">{{ 'auth.login.emailLabel' | translate }}</label>
        <input
          id="email"
          type="email"
          formControlName="email"
          [placeholder]="'auth.login.emailPlaceholder' | translate"
          [class.invalid]="emailControl.invalid && emailControl.touched"
          autocomplete="email"
        />
        <app-field-error [control]="emailControl" fieldName="email"></app-field-error>
      </div>

      <!-- Campo Senha -->
      <div class="form-field">
        <label for="password">{{ 'auth.login.passwordLabel' | translate }}</label>
        <input
          id="password"
          type="password"
          formControlName="password"
          [placeholder]="'auth.login.passwordPlaceholder' | translate"
          [class.invalid]="passwordControl.invalid && passwordControl.touched"
          autocomplete="current-password"
        />
        <app-field-error [control]="passwordControl" fieldName="password"></app-field-error>
      </div>

      <!-- Checkbox Lembrar -->
      <div class="form-checkbox">
        <input id="rememberMe" type="checkbox" formControlName="rememberMe" />
        <label for="rememberMe">{{ 'auth.login.rememberMeLabel' | translate }}</label>
      </div>

      <!-- Botão Submit -->
      <button type="submit" class="btn-primary" [disabled]="loginForm.invalid || isSubmitting || isOAuthInProgress">
        {{ isSubmitting ? ('auth.login.submittingButton' | translate) : ('auth.login.submitButton' | translate) }}
      </button>
    </form>

    <footer class="auth-footer">
      <a routerLink="/auth/register">{{ 'auth.login.registerLink' | translate }}</a>
      <a routerLink="/auth/forgot-password">{{ 'auth.login.forgotPasswordLink' | translate }}</a>
    </footer>
  </div>
</section>
