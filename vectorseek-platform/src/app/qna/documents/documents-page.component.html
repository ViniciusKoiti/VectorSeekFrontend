<div class="content-wrapper">
  <div class="page-header">
    <div class="documents-header">
      <div>
        <h1 class="page-title">Documentos</h1>
        <p class="page-description">Gerencie seus documentos</p>
      </div>
      <button class="btn btn-primary upload-button" (click)="openUploadDialog()">
        + Upload Documento
      </button>
    </div>

    <!-- Filters -->
    <div class="filters-section">
      <div class="filter-group">
        <label for="workspace-filter">Workspace:</label>
        <select
          id="workspace-filter"
          [(ngModel)]="selectedWorkspaceId"
          (change)="onWorkspaceChange()"
          [disabled]="workspacesLoading()"
        >
          <option value="">Todos</option>
          @for (workspace of workspaces(); track workspace.id) {
            <option [value]="workspace.id">{{ workspace.name }}</option>
          }
        </select>
        @if (workspacesLoading()) {
          <span class="filter-hint">Carregando...</span>
        } @else if (workspaceError()) {
          <span class="filter-hint error">{{ workspaceError() }}</span>
        }
      </div>

      <div class="filter-group">
        <label for="status-filter">Status:</label>
        <select id="status-filter" [(ngModel)]="statusFilter" (change)="onFilterChange()">
          <option value="">Todos</option>
          <option value="processing">Processando</option>
          <option value="completed">Conclu√≠do</option>
          <option value="failed">Erro</option>
          <option value="pending">Pendente</option>
        </select>
      </div>

      <div class="filter-actions">
        <button (click)="onRefresh()" class="btn btn-secondary">
          Atualizar
        </button>
        <button (click)="onExportCSV()" class="btn btn-secondary" [disabled]="documents().length === 0">
          Exportar CSV
        </button>
      </div>
    </div>

    <!-- Loading State -->
    @if (loading()) {
      <div class="loading-panel">
        <div class="spinner"></div>
        <p>Carregando documentos...</p>
      </div>
    }

    <!-- Error State -->
    @if (error()) {
      <div class="error-panel">
        <span class="error-icon">‚ö†Ô∏è</span>
        <div class="error-content">
          <strong>{{ error()?.summary }}</strong>
          @if (error()?.description) {
            <p>{{ error()?.description }}</p>
          }
        </div>
      </div>
    }

    <!-- Documents Table -->
    @if (!loading() && !error() && documents().length > 0) {
      <div class="table-container">
        <table class="documents-table">
          <thead>
            <tr>
              <th>T√≠tulo</th>
              <th>Status</th>
              <th>Tamanho</th>
              <th>Workspace</th>
              <th>Data de Cria√ß√£o</th>
              <th>Chunks</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody>
            @for (doc of documents(); track doc.id) {
              <tr>
                <td class="doc-title">{{ doc.title || doc.filename }}</td>
                <td>
                  <span class="status-badge" [attr.data-status]="doc.status">
                    {{ getStatusLabel(doc.status) }}
                  </span>
                </td>
                <td>{{ formatSize(doc.size) }}</td>
                <td>{{ doc.workspaceName || '-' }}</td>
                <td>{{ formatDate(doc.createdAt) }}</td>
                <td>{{ doc.embeddingCount }}</td>
                <td class="actions-cell">
                  <div class="action-buttons">
                    <button (click)="onViewDetails(doc)" class="btn-link" title="Ver detalhes">
                      Detalhes
                    </button>
                    <button
                      (click)="onReprocessDocument(doc)"
                      class="btn-action"
                      [disabled]="isActionLoading(doc.id, 'reprocess')"
                    >
                      {{ isActionLoading(doc.id, 'reprocess') ? 'Processando...' : 'Reprocessar' }}
                    </button>
                    <button
                      (click)="onDeleteDocument(doc)"
                      class="btn-action btn-action-danger"
                      [disabled]="isActionLoading(doc.id, 'delete')"
                    >
                      {{ isActionLoading(doc.id, 'delete') ? 'Deletando...' : 'Deletar' }}
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      @if (pagination().totalPages > 1) {
        <div class="pagination">
          <button
            (click)="onPreviousPage()"
            [disabled]="pagination().page === 1"
            class="btn btn-secondary"
          >
            ‚Üê Anterior
          </button>
          <span class="pagination-info">
            P√°gina {{ pagination().page }} de {{ pagination().totalPages }}
            ({{ pagination().total }} documentos)
          </span>
          <button
            (click)="onNextPage()"
            [disabled]="pagination().page >= pagination().totalPages"
            class="btn btn-secondary"
          >
            Pr√≥xima ‚Üí
          </button>
        </div>
      }
    }

    <!-- Empty State -->
    @if (!loading() && !error() && documents().length === 0) {
      <div class="empty-state">
        <div class="empty-icon">üìÑ</div>
        <h3>Nenhum documento encontrado</h3>
        <p>Nenhum documento foi indexado ainda ou n√£o corresponde aos filtros aplicados</p>
      </div>
    }
  </div>
</div>
