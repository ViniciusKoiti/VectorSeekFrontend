---
id: E1-A4
epic: "Épico 1 — Fundação de Autenticação & Shell da Aplicação"
status: backlog
tags:
  - frontend
  - angular
  - roteamento
  - obsidian/backlog
dependencies:
  - E1-A1
  - E1-A2
  - E1-A3
obsidian-link: "[[E1-A4 Configurar rotas públicas e protegidas]]"
---

# E1-A4 · Configurar rotas públicas e protegidas

## Descrição técnica
- Definir `app.routes.ts` com lazy loading para `auth.routes` e `app-shell.routes` usando `loadChildren`.
- Implementar `AuthGuard` e `PlanGuard` em `libs/state/auth` combinando Signal Store e claims retornados em `/api/auth/me`.
- Adicionar `UserResolver` para pré-carregar dados do usuário antes de renderizar `/app/*`.
- Garantir compatibilidade SSR configurando `provideRouter` com `withComponentInputBinding` e `withInMemoryScrolling`.
- Mapear rotas públicas adicionais (ex.: `/share/:token`) com layout simplificado.

## Dependências
- [[E1-A1 Configurar módulo de autenticação]].
- [[E1-A2 Implementar interceptores e refresh token]].
- [[E1-A3 Construir app shell responsivo]].

## Critérios de aceite
- Usuários não autenticados são redirecionados automaticamente para `/auth/login` ao acessar `/app/*`.
- Guardas bloqueiam funcionalidades fora do plano exibindo página de upgrade configurável.
- Navegação SSR funciona tanto no servidor quanto no cliente sem erros de hidratação.

## Checklist sugerido
- [ ] Definir rotas e lazy loading.
- [ ] Implementar guardas com Signal Store.
- [ ] Criar resolver para dados do usuário.
- [ ] Configurar rota pública de compartilhamento.
- [ ] Validar navegação com testes de integração (`@angular-architects/module-federation/testing` ou `Spectator`).
