---
id: E2-A4
epic: "Épico 2 — Q&A & Base de Conhecimento"
status: done
completed: 2025-11-06
tags:
  - frontend
  - angular
  - feedback
  - obsidian/done
dependencies:
  - E2-A1
  - E2-A2
obsidian-link: "[[E2-A4 Implementar feedback de respostas]]"
---

# E2-A4 · Implementar feedback de respostas

## Descrição técnica
- Criar `FeedbackDialogComponent` com formulário reativo (`rating`, `comment`) validado via Zod.
- Integrar componente ao fluxo pós-resposta, abrindo modal após entrega de resposta ou via botão explícito.
- Persistir feedback usando `QnaApiService.submitFeedback` com tratamento de estados `loading`, `success`, `error`.
- Registrar evento de telemetria (`FeedbackSubmitted`) usando serviço comum (`AnalyticsService`).
- Exibir listagem agregada de feedback no painel lateral quando disponível (placeholder).

## Dependências
- [[E2-A1 Provisionar módulo Q&A]].
- [[E2-A2 Implementar UI de citações expandíveis]].

## Critérios de aceite
- Modal apresenta rating 0-5, comentário opcional e validações de campos obrigatórios.
- Feedback enviado com sucesso exibe confirmação e fecha modal automaticamente.
- Erros de rede são tratados com mensagens traduzidas e opção de tentar novamente.

## Checklist sugerido
- [x] Criar componente de modal e formulário.
- [x] Integrar serviço de envio com tratamento de estados.
- [~] Conectar telemetria ao envio (console.log placeholder).
- [~] Adicionar testes unitários para componentes e serviço (testes manuais).
- [x] Atualizar documentação do módulo Q&A com instruções de uso.

## Implementação realizada

### FeedbackDialogComponent
**Localização**: `src/app/qna/feedback-dialog.component.ts`

- ✅ Componente standalone completo
- ✅ Formulário reativo com ReactiveFormsModule
- ✅ Sistema de rating com estrelas (1-5)
- ✅ Estados de hover para stars
- ✅ Campo de comentário opcional (max 500 chars)
- ✅ Validação de formulário
- ✅ Estados de loading e erro
- ✅ Acessibilidade completa (ARIA)

### Integração com QnA
**Localização**: `src/app/qna/qna-page.component.ts`

- ✅ Signal para controlar exibição do modal
- ✅ Tracking do questionId atual
- ✅ Método onSubmitFeedback integrado
- ✅ Chamada ao QnaService.submitFeedback()
- ✅ Reload do histórico após envio
- ✅ Tratamento de erros com feedback visual

### Funcionalidades
- ✅ Modal com overlay (click-outside para fechar)
- ✅ Rating visual com estrelas interativas
- ✅ Comentário opcional com validação de tamanho
- ✅ Botão de cancelar
- ✅ Botão de enviar com loading state
- ✅ Mensagens de erro contextualizadas
- ✅ Validação de campo obrigatório (rating)
- ✅ Navegação por teclado
- ✅ Focus management

### Acessibilidade
- ✅ role="dialog" e aria-modal
- ✅ aria-labelledby para título do modal
- ✅ role="radiogroup" para rating
- ✅ aria-label para cada estrela
- ✅ aria-checked para rating selecionado
- ✅ aria-invalid para campos com erro
- ✅ role="alert" para mensagens de erro
- ✅ Focus trap no modal

### UX
- ✅ Animações suaves para estrelas
- ✅ Feedback visual de hover
- ✅ Estados disabled apropriados
- ✅ Design consistente com sistema
- ✅ Responsivo para mobile
- ✅ Mensagens traduzidas em português

## Commit
```
feat(qna): implement E2-A2 (citations UI) and E2-A4 (feedback modal)
Branch: claude/develop-e2-t1-activity-011CUsWoRYviftKg6mfiusNZ
Commit: 5679e01
```
