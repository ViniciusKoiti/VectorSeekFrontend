# E8-T2 — Implementar UI para CRUD de Documentos

## Objetivo
Implementar interface de usuário para gerenciar documentos: ver detalhes, reprocessar e deletar. **Backend 100% pronto com 5 endpoints + 26 testes** (verificado 15 Nov 2025). Os services já estão prontos no frontend (`DocumentsService`).

## Dependências
- ✅ `E8-T1` (COMPLETO - Endpoints de documentos já implementados no backend)

## Status Geral
**Backend:** ✅ 100% IMPLEMENTADO (15 Nov 2025)
- ✅ POST /api/documents/upload (linha 70)
- ✅ GET /api/documents (linha 166)
- ✅ GET /api/documents/:id (linha 238)
- ✅ DELETE /api/documents/:id (linha 289)
- ✅ POST /api/documents/:id/reprocess (linha 334)
- ✅ 26 testes de integração passando
- ✅ Rate limiting, text extraction, deduplicação implementados

**Frontend:** ✅ 100% IMPLEMENTADO — Lista, detalhe, reprocessamento, delete e upload integrados no frontend (19 Nov 2025)

## Entregáveis
**Legenda de status:** `[x]` Concluído · `[~]` Parcial · `[ ]` Pendente

- [x] `DocumentDetailComponent` criado com modal/página de detalhes
- [x] Rota `/app/documents/:id` adicionada ao routing
- [x] Botões de ação (Reprocessar, Deletar) integrados na tabela
- [x] Modal de confirmação para ações irreversíveis
- [x] Feedback visual (toast/snackbar) para sucesso e erro
- [x] Lista de documentos atualizada após operações
- [x] Testes unitários para novos componentes

## Tarefas Específicas

### 1. Visualizar Detalhes de Documento (GET /api/documents/:id)

**O que Implementar:**
- [x] Novo componente `DocumentDetailComponent` (standalone Angular component)
- [x] Modal ou página dedicada para exibir detalhes
- [x] Rota `/app/documents/:id` apontando para detalhe
- [x] Chamar `DocumentsService.getDocumentDetail(id)`

**Informações a Exibir:**
- Título e metadata (criação, última atualização)
- Número de chunks processados
- Status de processamento (PENDING, PROCESSING, COMPLETED, FAILED)
- Tempo total de processamento
- Botões de ação (Reprocessar, Deletar)
- Botão de voltar para lista

**Componentes Afetados:**
- Novo: `DocumentDetailComponent`
- `DocumentsPageComponent` - adicionar link na tabela

**Código do Service (já existe):**
```typescript
// Em src/app/services/documents.service.ts
getDocumentDetail(id: string): Observable<DocumentDetail>
```

### 2. Reprocessar Documento (POST /api/documents/:id/reprocess)

**O que Implementar:**
- [x] Botão "Reprocessar" na tabela de documentos
- [x] Botão "Reprocessar" no detalhe do documento
- [x] Modal de confirmação (simples)
- [x] Chamar `DocumentsService.reprocessDocument(id)`
- [x] Atualizar status na UI durante processamento
- [x] Mostrar feedback de sucesso
- [x] Recarregar lista após conclusão

**Componentes Afetados:**
- `DocumentsPageComponent` - adicionar botão e handler
- `DocumentDetailComponent` - adicionar botão e handler
- Modal de confirmação reutilizável

**Código do Service (já existe):**
```typescript
reprocessDocument(id: string): Observable<ReprocessResponse>
```

### 3. Deletar Documento (DELETE /api/documents/:id)

**O que Implementar:**
- [x] Botão "Deletar" na tabela de documentos
- [x] Botão "Deletar" no detalhe do documento
- [x] Modal de confirmação **com aviso de irreversibilidade**
- [x] Chamar `DocumentsService.deleteDocument(id)`
- [x] Remover linha da tabela após sucesso
- [x] Mostrar notificação (toast)
- [x] Redirecionar para lista após deletar de detalhe

**Componentes Afetados:**
- `DocumentsPageComponent` - adicionar botão e handler
- `DocumentDetailComponent` - adicionar botão e handler
- Modal de confirmação com aviso visual

**Código do Service (já existe):**
```typescript
deleteDocument(id: string): Observable<void>
```

## Estrutura de Componentes Proposta

```
src/app/features/documents/
├── pages/
│   ├── documents-page.component.ts
│   ├── documents-page.component.html
│   └── documents-page.component.scss
├── components/
│   ├── document-detail/
│   │   ├── document-detail.component.ts      [NOVO]
│   │   ├── document-detail.component.html    [NOVO]
│   │   └── document-detail.component.scss    [NOVO]
│   ├── document-list-table/
│   │   └── (já existe)
│   └── delete-confirmation-modal/            [NOVO - reutilizável]
│       ├── delete-confirmation-modal.component.ts
│       ├── delete-confirmation-modal.component.html
│       └── delete-confirmation-modal.component.scss
└── services/
    └── documents.service.ts (já existe)
```

## Orientações de Implementação

1. **Componente DocumentDetailComponent**
   - Usar `ActivatedRoute` para obter `:id` da URL
   - Chamar `getDocumentDetail(id)` no `ngOnInit`
   - Tratar estados: loading, sucesso, erro
   - Exibir spinner enquanto carrega

2. **Modal de Confirmação Reutilizável**
   - Criar componente genérico `ConfirmationModalComponent`
   - Aceitar título, mensagem e callback de confirmação
   - Usar Angular Material Dialog ou Bootstrap modal

3. **Feedback Visual**
   - Usar NgxSnackBar ou similiar para toasts
   - Mostrar sucesso: "Documento reprocessado com sucesso"
   - Mostrar erro: "Erro ao reprocessar. Tente novamente"

4. **Atualização de Lista**
   - Após sucesso, recarregar lista via `getDocuments()`
   - Ou atualizar item específico no array local

## Padrões de Código Obrigatórios
- Seguir padrão de componentes standalone do Angular 16+
- Usar Reactive Forms para qualquer formulário
- Implementar `OnDestroy` e `unsubscribe()` adequadamente
- Adicionar `trackBy` em `*ngFor` para performance
- Validar inputs com `@Input()` usando getters
- Documentar componentes públicos com comentários JSDoc

## Testes Obrigatórios
**Legenda de status:** `[x]` Concluído · `[~]` Parcial · `[ ]` Pendente

- [x] Teste unitário: `DocumentDetailComponent` carrega dados ao inicializar
- [x] Teste unitário: Botão "Reprocessar" chama service corretamente
- [x] Teste unitário: Modal de confirmação dispara callback
- [x] Teste unitário: Erro na API é tratado e exibido ao usuário
- [x] Teste de integração: Fluxo completo de delete (confirmação → chamada → atualização lista)
- [x] Teste de navegação: Clicar em documento na tabela abre detalhe

## Estimativa
**Responsável:** Frontend Team
**Deadline:** 23 de Novembro (prioridade alta)
**Estimativa:** 2-3 dias de trabalho
**Status:** ✅ Concluído - CRUD de documentos funcional e testado no frontend (19 Nov 2025)
**Atualizado:** 19 de Novembro de 2025

### Por que começar agora?
- ✅ Backend 100% implementado e testado
- ✅ API estável com validações robustas
- ✅ Documentação de endpoints completa
- ✅ Rate limiting e segurança implementados
- ✅ Sem bloqueadores - frontend pode integrar imediatamente

## Links Relacionados
- [Fluxo_Documentos.md](../frontend/Fluxos/Fluxo_Documentos.md)
- [Status_Implementação.md](../frontend/status/Status_Implementação.md)
- [agents_vector_dev.md](../frontend/agents_vector_dev.md)
