---
id: E5-A6
epic: "Épico 5 — Chat Conversacional & Experiências Multimodais"
status: backlog
tags:
  - frontend
  - angular
  - chat
  - quotas
  - obsidian/backlog
dependencies:
  - E5-A2
  - E4-telemetry-foundation
obsidian-link: "[[E5-A6 Tratamento de respostas 429 (QuotaExceeded)]]"
---

# E5-A6 · Tratamento de respostas 429 (QuotaExceeded)

## Descrição técnica
- Estender `ChatApiService` para mapear respostas 429 em erro customizado (`QuotaExceededError`).
- Criar `QuotaExceededDialogComponent` standalone com instruções de upgrade e link para gestão de planos.
- Configurar interceptor global (`HttpErrorInterceptor`) para capturar 429, abrir diálogo e registrar evento via `TelemetryService`.
- Atualizar `ChatStore` para marcar conversas bloqueadas (`markAsBlocked`) e impedir novos envios até `resetQuota`.
- Adicionar testes de integração para interceptor e store assegurando fluxo completo.

## Dependências
- `E5-A2` (store implementada) e infraestrutura de telemetria do épico 4.

## Critérios de aceite
- Ao receber 429, diálogo é exibido, evento é registrado e conversa fica bloqueada até reset manual.
- Tentativas subsequentes mostram aviso inline sem chamar API.
- Testes cobrem cenário completo (serviço + interceptor + store).

## Checklist sugerido
- [ ] Implementar erro customizado no serviço.
- [ ] Criar componente de diálogo com conteúdo UX.
- [ ] Ajustar interceptor global para orquestrar diálogo e telemetria.
- [ ] Atualizar store para bloquear conversa e prover método de reset.
- [ ] Escrever testes cobrindo 429 e desbloqueio.
