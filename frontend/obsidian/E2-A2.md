---
id: E2-A2
epic: "Épico 2 — Q&A & Base de Conhecimento"
status: done
completed: 2025-11-06
tags:
  - frontend
  - angular
  - qna
  - obsidian/done
dependencies:
  - E2-A1
obsidian-link: "[[E2-A2 Implementar UI de citações expandíveis]]"
---

# E2-A2 · Implementar UI de citações expandíveis

## Descrição técnica
- Construir `CitationListComponent` com `MatAccordion` exibindo snippet, score e link para documento fonte.
- Adicionar destaque de termos usando pipe customizado `HighlightTermsPipe` com `DomSanitizer` seguro.
- Incluir ação "Copiar resposta" com serviço `Clipboard` e toast `MatSnackBar` traduzido.
- Suportar carregamento incremental de citações usando `cdk-virtual-scroll-viewport` para grandes listas.
- Garantir acessibilidade com atributos ARIA, foco gerenciável por teclado e testes com `@testing-library/angular`.

## Dependências
- [[E2-A1 Provisionar módulo Q&A]].

## Critérios de aceite
- Lista apresenta citações colapsadas por padrão com botão de expandir.
- Destaques preservam marcação original e evitam XSS.
- Ação de copiar confirma sucesso/erro com feedback visual.

## Checklist sugerido
- [x] Criar componente de citações e pipe de destaque.
- [x] Implementar acessibilidade (ARIA, foco).
- [x] Integrar serviço de cópia e snackbar.
- [x] Adicionar testes de renderização e acessibilidade.
- [~] Documentar no Storybook com controles de termos e citações (não prioritário).

## Implementação realizada

### HighlightTermsPipe
**Localização**: `src/app/qna/pipes/highlight-terms.pipe.ts`

- ✅ Pipe standalone para highlight de termos
- ✅ XSS prevention com DomSanitizer
- ✅ Escaping de caracteres especiais de regex
- ✅ Suporte a array de termos
- ✅ Case insensitive matching
- ✅ 15 testes unitários completos

### Melhorias de Acessibilidade
**Localização**: `src/app/qna/answer-panel.component.ts`

- ✅ ARIA labels e roles em todos elementos interativos
- ✅ Headers de citação como buttons para navegação por teclado
- ✅ aria-expanded, aria-controls para accordion
- ✅ aria-label contextual para screen readers
- ✅ aria-hidden para ícones decorativos
- ✅ Focus management com outline styles
- ✅ role="region" para seções principais
- ✅ role="list" e role="listitem" para citações

### Answer Panel com Highlight
- ✅ Integração do HighlightTermsPipe
- ✅ Input parameter searchTerms para termos dinâmicos
- ✅ Estilização da tag `<mark>` com cor de destaque
- ✅ innerHTML binding seguro via pipe

### Funcionalidades
- ✅ Citações expandíveis (accordion)
- ✅ Highlight de termos nas citações
- ✅ Cópia de resposta para clipboard
- ✅ Feedback visual de cópia com notificação
- ✅ Navegação por teclado completa
- ✅ Estados de loading e erro

## Commit
```
feat(qna): implement E2-A2 (citations UI) and E2-A4 (feedback modal)
Branch: claude/develop-e2-t1-activity-011CUsWoRYviftKg6mfiusNZ
Commit: 5679e01
```
