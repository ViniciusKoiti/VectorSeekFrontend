# E8-T6 — Implementar CRUD de Workspaces

## Objetivo
Implementar endpoints e UI para gerenciar workspaces (criar, editar, deletar). Atualmente apenas listagem está funcional.

## Dependências
- `E8-T1` (Sincronizar endpoints com backend)

## Entregáveis
**Legenda de status:** `[x]` Concluído · `[~]` Parcial · `[ ]` Pendente

### Backend
- [ ] `POST /api/workspaces` — Criar novo workspace
- [ ] `PUT /api/workspaces/:id` — Editar workspace
- [ ] `DELETE /api/workspaces/:id` — Deletar workspace
- [ ] Validações de nome (obrigatório, comprimento)
- [ ] Verificação de permissões (owner can manage)
- [ ] Testes para todos os endpoints

### Frontend
- [x] Página `/app/workspaces` com listagem
- [x] Tabela com workspaces (nome, descrição, criado em, ações)
- [x] Botão \"Novo Workspace\" abre modal
- [x] Modal de criação/edição de workspace (`WorkspaceFormDialogComponent`)
- [x] Modal de confirmação para deletar (`WorkspaceDeleteDialogComponent`)
- [x] Feedback visual (toast de sucesso/erro)
- [x] Testes unitários e integração básica

## Especificação de Endpoints Backend

### POST /api/workspaces — Criar Workspace

**Request:**
```json
{
  "name": "Meu Workspace",
  "description": "Descrição opcional"
}
```

**Response (201 Created):**
```json
{
  "data": {
    "id": "uuid",
    "name": "Meu Workspace",
    "description": "Descrição opcional",
    "owner_id": "uuid",
    "created_at": "2025-11-12T10:30:00Z",
    "updated_at": "2025-11-12T10:30:00Z"
  }
}
```

**Validações:**
- `name` obrigatório (1-100 caracteres)
- `description` opcional (0-500 caracteres)
- Verificar limite de workspaces por plano (Free: 1, Pro: 5, Enterprise: unlimited)

**Error Responses:**
```json
{
  "error": "Workspace quota exceeded",
  "limit": 1,
  "plan": "free"
}
```

---

### PUT /api/workspaces/:id — Editar Workspace

**Request:**
```json
{
  "name": "Nome Atualizado",
  "description": "Nova descrição"
}
```

**Response (200 OK):**
```json
{
  "data": {
    "id": "uuid",
    "name": "Nome Atualizado",
    "description": "Nova descrição",
    "owner_id": "uuid",
    "created_at": "2025-11-12T10:30:00Z",
    "updated_at": "2025-11-12T11:00:00Z"
  }
}
```

**Validações:**
- Usuário deve ser owner do workspace
- Mesmas validações de campo que criação

**Error Responses:**
```json
{
  "error": "Workspace not found"
}
```

```json
{
  "error": "Not authorized to edit this workspace"
}
```

---

### DELETE /api/workspaces/:id — Deletar Workspace

**Request:**
```
DELETE /api/workspaces/{id}
```

**Response (204 No Content)**

**Validações:**
- Usuário deve ser owner
- Considerar: deletar documentos associados? (soft delete?)
- Documentação de política de retenção

**Error Responses:**
```json
{
  "error": "Workspace not found"
}
```

```json
{
  "error": "Cannot delete workspace with documents"
}
```

---

## Implementação Frontend

### 1. Data access dedicado
- Criado `libs/data-access/src/lib/workspaces` com `workspaces.api.ts`, `workspaces.models.ts` e `workspaces.service.ts`.
- Métodos implementados: listar, criar, atualizar e deletar workspaces com normalização de erros.
- Conversão snake_case → camelCase e datas convertidas para `Date`.

### 2. Página `/app/workspaces`
- `WorkspacesPageComponent` standalone com sinais (`workspaces`, `loading`, `error`).
- Tabela com nome/descrição/criado em, vazios/erro/carregamento e botão “+ Novo workspace”.
- Integração com `MatSnackBar` e atualizações otimistas da lista após operações.

### 3. Dialogs reutilizáveis
- `WorkspaceFormDialogComponent`: Reactive Forms com validações (nome 1–100, descrição até 500).
- `WorkspaceDeleteDialogComponent`: confirmação antes de remover.
- Ambos são standalone e integrados ao `MatDialog`.

### 4. Navegação e rotas
- Nova rota lazy `/app/workspaces` em `app.routes.ts`.
- Item “Workspaces” incluído no `NavbarComponent` (desktop e mobile).

## Orientações de Implementação

1. **Validações**
   - Nome: obrigatório, 1-100 caracteres
   - Descrição: opcional, máx 500 caracteres
   - Mostrar erros inline no formulário

2. **Permissões**
   - Verificar se usuário é owner antes de editar/deletar
   - Backend deve validar também

3. **Estado**
   - Desabilitar buttons durante operação
   - Mostrar spinner/loader
   - Atualizar UI após sucesso

4. **Fluxo de Delete**
   - Modal de confirmação clara
   - Avisar sobre implicações (documentos associados)
   - Confirm button em destaque

## Padrões de Código Obrigatórios
- Usar componentes standalone Angular 16+
- Implementar reactive forms
- OnDestroy para unsubscribe
- Error handling robusto
- Material Design components
- Documentar componentes com JSDoc

## Testes Obrigatórios
**Legenda de status:** `[x]` Concluído · `[~]` Parcial · `[ ]` Pendente

### Backend
- [ ] Teste: POST /api/workspaces cria workspace
- [ ] Teste: PUT /api/workspaces/:id edita workspace
- [ ] Teste: DELETE /api/workspaces/:id deleta workspace
- [ ] Teste: Validações de nome/descrição funcionam
- [ ] Teste: Usuário não-owner não pode editar/deletar
- [ ] Teste: Quota de workspaces é respeitada

### Frontend
- [ ] Teste: Página carrega lista de workspaces
- [ ] Teste: Botão "Novo Workspace" abre modal
- [ ] Teste: Formulário valida nome obrigatório
- [ ] Teste: Ao salvar, chamada POST é feita
- [ ] Teste: Ao editar, chamada PUT é feita
- [ ] Teste: Modal de delete requer confirmação
- [ ] Teste: Após delete, workspace é removido da lista
- [ ] Teste: Toast de sucesso/erro aparecem

## Estimativa
**Responsável:** Backend Team (2-3 dias) + Frontend Team (2-3 dias)
**Deadline:** 23 de Novembro
**Estimativa:** 3-4 dias total
**Status:** ⏳ Não Iniciado

## Links Relacionados
- [agents_vector_dev.md](../frontend/agents_vector_dev.md)
- [Status_Implementação.md](../frontend/status/Status_Implementação.md)
