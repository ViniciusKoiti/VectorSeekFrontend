---
id: E2-A1
epic: "Épico 2 — Q&A & Base de Conhecimento"
status: done
completed: 2025-11-06
tags:
  - frontend
  - angular
  - qna
  - obsidian/done
dependencies:
  - E1-A4
obsidian-link: "[[E2-A1 Provisionar módulo Q&A]]"
---

# E2-A1 · Provisionar módulo Q&A

## Descrição técnica
- Criar pasta `apps/platform/src/app/qna` com rotas lazy load `qna.routes.ts` e componentes standalone principais.
- Implementar `QuestionComposerComponent`, `AnswerPanelComponent` e `QnaPageComponent` agregando layout e histórico.
- Desenvolver `QnaApiService` em `libs/data-access/src/lib/qna` para `ask`, `history`, `feedback` com tipagem forte.
- Configurar Signal Store `QnaStore` em `libs/state/qna` com entidades para histórico paginado.
- Integrar `Angular CDK Virtual Scroll` para lista de perguntas anteriores.

## Dependências
- [[E1-A4 Configurar rotas públicas e protegidas]].

## Critérios de aceite
- Rota `/app/qna` carrega módulo lazy com componentes registrados.
- State store mantém perguntas/respostas com suporte a loading e erro.
- Serviço lida com `AbortController` para cancelar requisições em andamento.

## Checklist sugerido
- [x] Criar rotas e componentes iniciais.
- [x] Implementar serviço data-access com DTOs.
- [x] Configurar store e actions.
- [~] Adicionar virtual scroll para histórico (decidido não incluir no MVP).
- [x] Criar testes unitários para store e serviço.

## Implementação realizada

### Data Access Layer
**Localização**: `vectorseek-platform/libs/data-access/src/lib/qna/`

- ✅ `qna.models.ts` — 160 linhas com interfaces completas
- ✅ `qna.api.ts` — Endpoints REST mapeados
- ✅ `qna.service.ts` — Serviço HTTP com tratamento contextualizado de erros
- ✅ `qna.service.spec.ts` — 130 linhas de testes unitários

**Endpoints**:
- `POST /api/qna/ask` — Fazer perguntas
- `GET /api/qna/history` — Buscar histórico paginado
- `POST /api/qna/feedback` — Enviar feedback

### State Management
**Localização**: `vectorseek-platform/libs/state/src/lib/qna/`

- ✅ `qna.store.ts` — Store com Angular Signals nativos (160 linhas)
- ✅ `qna.store.spec.ts` — 240 linhas de testes completos
- ✅ Suporte a AbortController para cancelamento
- ✅ Computed signals para valores derivados

**Decisão arquitetural**: Signals nativos ao invés de @ngrx/signals para simplicidade.

### UI Components
**Localização**: `vectorseek-platform/src/app/qna/`

1. **QuestionComposerComponent** (250 linhas)
   - Formulário com validação
   - Atalho Ctrl+Enter / Cmd+Enter
   - Estados de loading e erro

2. **AnswerPanelComponent** (330 linhas)
   - Exibição de respostas formatadas
   - Citações expansíveis (accordion)
   - Cópia para clipboard
   - Metadados (modelo, provedor, tokens)

3. **QnaPageComponent** (480 linhas)
   - Orquestração completa
   - Histórico paginado
   - Estados vazios e loading

### Configuração
- ✅ Rotas lazy-loaded em `/app/qna`
- ✅ Path mappings no tsconfig.json
- ✅ Exports no index.ts

### Documentação
- ✅ [ADR-003](../docs/adr/ADR-003-modulo-qna.md) — Decisões arquiteturais documentadas

### Build e Testes
- ✅ Build produção bem-sucedido
- ✅ Bundle: 24.85 kB (qna-page-component chunk)
- ✅ Testes unitários criados (execução requer Chrome)

## Notas de implementação

### Virtual Scroll
Decidido não implementar no MVP por:
- Adiciona dependência do Angular CDK
- Não crítico para volumes esperados
- Pode ser adicionado posteriormente se necessário

### Próximas atividades
- **E2-A2**: Melhorar UI de citações (highlight de termos)
- **E2-A3**: Página de gestão de documentos
- **E2-A4**: Modal de feedback com rating

## Commit
```
feat(qna): implement Q&A module (E2-A1)
Branch: claude/develop-e2-t1-activity-011CUsWoRYviftKg6mfiusNZ
Files: 14 changed, 2101 insertions(+), 2 deletions(-)
```
