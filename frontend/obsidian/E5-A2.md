---
id: E5-A2
epic: "Épico 5 — Chat Conversacional & Experiências Multimodais"
status: backlog
tags:
  - frontend
  - angular
  - ngrx
  - chat
  - obsidian/backlog
dependencies:
  - E5-A1
obsidian-link: "[[E5-A2 Normalizar estado com Signal Store]]"
---

# E5-A2 · Normalizar estado com Signal Store

## Descrição técnica
- Criar `libs/state/chat` com `nx g @nx/angular:library chat --directory=state`.
- Implementar `ChatStore` usando `@ngrx/signals` com estados normalizados (`entities.conversations`, `entities.messages`, `ui`).
- Definir actions/métodos públicos: `loadConversations`, `openConversation`, `appendMessage`, `markAsBlocked`, `setStreamingState`.
- Integrar com `ChatApiService` através de efeitos side-effect free (`rxMethod` + `switchMap`/`tapResponse`).
- Expor selectors derivados (`activeConversation`, `unreadCount`, `isStreaming`).
- Cobrir lógicas críticas com testes unitários (`ChatStore.spec.ts`) usando `jest.spyOn` para mockar serviço.

## Dependências
- `E5-A1` finalizado para reutilizar o `ChatApiService`.

## Critérios de aceite
- Store acessível por `@vectorseek/state/chat` com API consistente.
- Operações de carregamento e envio atualizam entidades corretamente, inclusive merges incrementais.
- Cobertura mínima 80% para lógica de estado.

## Checklist sugerido
- [ ] Gerar biblioteca de estado com Nx.
- [ ] Definir interfaces de estado e selectors.
- [ ] Implementar métodos públicos e integração com `ChatApiService`.
- [ ] Criar testes unitários cobrindo fluxos de sucesso/erro.
- [ ] Documentar uso básico no README da biblioteca.
